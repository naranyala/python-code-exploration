<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>Apache ECharts Examples</title>

  <!-- Vue.js -->
  <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>

  <!-- Apache ECharts -->
  <script src="https://cdn.jsdelivr.net/npm/echarts@5.4.3/dist/echarts.min.js"></script>

  <!-- Prism.js for syntax highlighting -->
  <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-javascript.min.js"></script>

  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      background: #f8f9fa;
      color: #333;
    }

    .app {
      display: flex;
      height: 100vh;
    }

    .sidebar {
      width: 280px;
      background: #fff;
      border-right: 1px solid #e1e4e8;
      overflow-y: auto;
    }

    .sidebar-header {
      padding: 20px;
      border-bottom: 1px solid #e1e4e8;
      background: #f8f9fa;
    }

    .sidebar-header h1 {
      font-size: 1.5rem;
      color: #0366d6;
    }

    .nav-item {
      padding: 12px 20px;
      cursor: pointer;
      border-left: 3px solid transparent;
      transition: all 0.2s;
    }

    .nav-item:hover {
      background: #f6f8fa;
    }

    .nav-item.active {
      background: #e3f2fd;
      color: #0366d6;
      border-left-color: #0366d6;
    }

    .content {
      flex: 1;
      background: #fff;
      overflow-y: auto;
      padding: 40px;
    }

    .content h1 {
      margin-bottom: 20px;
      color: #1a1a1a;
    }

    .content h2 {
      margin: 25px 0 15px 0;
      color: #333;
    }

    .content p {
      margin-bottom: 15px;
      line-height: 1.6;
    }

    .content code {
      background: #f6f8fa;
      padding: 2px 6px;
      border-radius: 3px;
      font-family: monospace;
      font-size: 14px;
    }

    .content pre {
      background: #f6f8fa;
      padding: 20px;
      border-radius: 6px;
      overflow-x: auto;
      margin: 15px 0;
      border: 1px solid #e1e4e8;
    }

    .content pre code {
      background: none;
      padding: 0;
    }

    .content ul {
      margin: 15px 0;
      padding-left: 25px;
    }

    .content li {
      margin: 5px 0;
    }

    .welcome {
      text-align: center;
      padding: 100px 20px;
      color: #666;
    }

    .welcome h1 {
      color: #0366d6;
      margin-bottom: 15px;
    }

    /* Chart container */
    .chart-container {
      width: 100%;
      height: 400px;
      margin: 20px 0;
      border: 1px solid #e1e4e8;
      border-radius: 6px;
    }

    .chart-title {
      font-size: 1.1rem;
      font-weight: 600;
      color: #333;
      margin-bottom: 10px;
      padding-left: 5px;
    }
  </style>
</head>

<body>
  <div id="app">
    <div class="app">
      <nav class="sidebar">
        <div class="sidebar-header">
          <h1>ECharts Examples</h1>
        </div>
        <div v-for="item in docData" :key="item.id" :class="['nav-item', { active: activeItem === item.id }]"
          @click="setActive(item.id)">
          {{ item.title }}
        </div>
      </nav>

      <main class="content">
        <div v-if="currentDoc">
          <div v-html="currentDoc.content"></div>
          <div v-for="(chart, index) in currentDoc.charts" :key="index">
            <div v-if="chart.name" class="chart-title">{{ chart.name }}</div>
            <div class="chart-container" :id="'chart-' + currentDoc.id + '-' + index"></div>
          </div>
        </div>
        <div v-else class="welcome">
          <h1>Welcome to ECharts Examples</h1>
          <p>Choose a chart type from the sidebar to view examples</p>
        </div>
      </main>
    </div>
  </div>

  <script type="application/json" id="docs-data">
  [
    {
      "id": "bar-chart",
      "title": "Bar Chart",
      "content": "<h1>Bar Chart Example</h1><p>Basic bar chart showing monthly sales data.</p>",
      "charts": [
        {
          "name": "Monthly Sales",
          "stringifyJson": "{\"title\":{\"text\":\"Monthly Sales\"},\"tooltip\":{},\"legend\":{\"data\":[\"Sales\"]},\"xAxis\":{\"data\":[\"Jan\",\"Feb\",\"Mar\",\"Apr\",\"May\",\"Jun\"]},\"yAxis\":{},\"series\":[{\"name\":\"Sales\",\"type\":\"bar\",\"data\":[120,200,150,80,70,110]}]}"
        }
      ]
    },
    {
      "id": "line-chart",
      "title": "Line Chart",
      "content": "<h1>Line Chart Example</h1><p>Line chart showing website traffic over time.</p>",
      "charts": [
        {
          "name": "Website Traffic",
          "stringifyJson": "{\"title\":{\"text\":\"Website Traffic\"},\"tooltip\":{\"trigger\":\"axis\"},\"legend\":{\"data\":[\"Visitors\",\"Page Views\"]},\"xAxis\":{\"type\":\"category\",\"data\":[\"Mon\",\"Tue\",\"Wed\",\"Thu\",\"Fri\",\"Sat\",\"Sun\"]},\"yAxis\":{\"type\":\"value\"},\"series\":[{\"name\":\"Visitors\",\"data\":[820,932,901,934,1290,1330,1320],\"type\":\"line\",\"smooth\":true},{\"name\":\"Page Views\",\"data\":[1200,1532,1401,1734,1890,1930,1820],\"type\":\"line\",\"smooth\":true}]}"
        }
      ]
    },
    {
      "id": "multi-chart",
      "title": "Multi Chart Example",
      "content": "<h1>Multiple Charts in One Article</h1><p>This example demonstrates rendering multiple charts within a single article.</p>",
      "charts": [
        {
          "name": "Sales Performance",
          "stringifyJson": "{\"title\":{\"text\":\"Sales Performance\"},\"tooltip\":{},\"legend\":{\"data\":[\"Q1\",\"Q2\"]},\"xAxis\":{\"data\":[\"Product A\",\"Product B\",\"Product C\",\"Product D\"]},\"yAxis\":{},\"series\":[{\"name\":\"Q1\",\"type\":\"bar\",\"data\":[320,302,301,334]},{\"name\":\"Q2\",\"type\":\"bar\",\"data\":[220,182,191,234]}]}"
        },
        {
          "name": "Market Distribution",
          "stringifyJson": "{\"title\":{\"text\":\"Market Distribution\",\"left\":\"center\"},\"tooltip\":{\"trigger\":\"item\"},\"legend\":{\"orient\":\"vertical\",\"left\":\"left\"},\"series\":[{\"name\":\"Market Share\",\"type\":\"pie\",\"radius\":\"50%\",\"data\":[{\"value\":1048,\"name\":\"Online\"},{\"value\":735,\"name\":\"Retail\"},{\"value\":580,\"name\":\"Partners\"},{\"value\":484,\"name\":\"Direct\"}],\"emphasis\":{\"itemStyle\":{\"shadowBlur\":10,\"shadowOffsetX\":0,\"shadowColor\":\"rgba(0, 0, 0, 0.5)\"}}}]}"
        }
      ]
    },
    {
      "id": "pie-chart",
      "title": "Pie Chart",
      "content": "<h1>Pie Chart Example</h1><p>Pie chart showing market share distribution.</p>",
      "charts": [
        {
          "name": "Market Share Analysis",
          "stringifyJson": "{\"title\":{\"text\":\"Market Share\",\"left\":\"center\"},\"tooltip\":{\"trigger\":\"item\"},\"legend\":{\"orient\":\"vertical\",\"left\":\"left\"},\"series\":[{\"name\":\"Market Share\",\"type\":\"pie\",\"radius\":\"50%\",\"data\":[{\"value\":1048,\"name\":\"Search Engine\"},{\"value\":735,\"name\":\"Direct\"},{\"value\":580,\"name\":\"Email\"},{\"value\":484,\"name\":\"Union Ads\"},{\"value\":300,\"name\":\"Video Ads\"}],\"emphasis\":{\"itemStyle\":{\"shadowBlur\":10,\"shadowOffsetX\":0,\"shadowColor\":\"rgba(0, 0, 0, 0.5)\"}}}]}"
        }
      ]
    }
  ]
  </script>

  <script>
    const {createApp, ref, computed, onMounted, watch, nextTick} = Vue;

    createApp({
      setup() {
        const activeItem = ref(null);
        const docData = ref([]);
        const chartInstances = ref({});

        // Load data from JSON script tag
        onMounted(() => {
          const dataScript = document.getElementById('docs-data');
          docData.value = JSON.parse(dataScript.textContent);
        });

        const currentDoc = computed(() => {
          return docData.value.find(doc => doc.id === activeItem.value);
        });

        const setActive = (id) => {
          activeItem.value = id;
        };

        // Initialize charts when content changes
        watch(currentDoc, (newVal, oldVal) => {
          if (newVal) {
            nextTick(() => {
              // Apply Prism.js syntax highlighting
              Prism.highlightAll();

              // Dispose old chart instances
              Object.keys(chartInstances.value).forEach(key => {
                if (chartInstances.value[key]) {
                  chartInstances.value[key].dispose();
                  delete chartInstances.value[key];
                }
              });

              // Initialize charts
              if (newVal.charts && newVal.charts.length > 0) {
                newVal.charts.forEach((chart, index) => {
                  const chartId = `chart-${newVal.id}-${index}`;
                  const chartDom = document.getElementById(chartId);

                  if (chartDom && chart.stringifyJson) {
                    try {
                      // Parse the JSON string to get chart options
                      const chartOption = JSON.parse(chart.stringifyJson);

                      // Create new chart instance
                      const myChart = echarts.init(chartDom);
                      myChart.setOption(chartOption);

                      // Store chart instance for later disposal
                      chartInstances.value[chartId] = myChart;

                      // Handle window resize
                      const resizeHandler = function () {
                        myChart.resize();
                      };
                      window.addEventListener('resize', resizeHandler);

                      // Store resize handler for cleanup
                      chartInstances.value[chartId]._resizeHandler = resizeHandler;
                    } catch (error) {
                      console.error(`Failed to parse chart JSON for ${chartId}:`, error);
                      chartDom.innerHTML = `<div style="display: flex; align-items: center; justify-content: center; height: 100%; color: #666;">Error loading chart: Invalid JSON</div>`;
                    }
                  }
                });
              }
            });
          }
        }, {immediate: true});

        // Cleanup on component unmount
        const cleanup = () => {
          Object.keys(chartInstances.value).forEach(key => {
            const instance = chartInstances.value[key];
            if (instance) {
              if (instance._resizeHandler) {
                window.removeEventListener('resize', instance._resizeHandler);
              }
              instance.dispose();
            }
          });
          chartInstances.value = {};
        };

        return {
          activeItem,
          docData,
          currentDoc,
          setActive,
          cleanup
        };
      }
    }).mount('#app');
  </script>
</body>

</html>
