<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Vue 3 Treeview</title>
  <script src="https://unpkg.com/vue@3/dist/vue.global.prod.js"></script>
  <script src="https://unpkg.com/goober"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
      background: #f5f5f5;
    }

    #app {
      max-width: 800px;
      margin: 0 auto;
      background: white;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
    }
  </style>
</head>

<body>
  <div id="app">
    <h1>Treeview Component</h1>
    <tree-view :nodes="treeData" :selected-id="selectedId" @select="handleSelect"></tree-view>

    <div v-if="selectedNode" style="margin-top: 20px; padding: 10px; background: #f0f0f0; border-radius: 4px;">
      Selected: {{ selectedNode.name }} (ID: {{ selectedNode.id }})
    </div>
  </div>

  <script>
    const {h, ref, computed} = Vue;
    const {css, setup} = goober;

    setup(h);

    // Tree data structure
    const treeData = [
      {
        id: 1,
        name: "Parent 1",
        children: [
          {
            id: 2,
            name: "Child 1.1",
            children: [
              {id: 5, name: "Grandchild 1.1.1"},
              {id: 6, name: "Grandchild 1.1.2"}
            ]
          },
          {id: 3, name: "Child 1.2"}
        ]
      },
      {
        id: 4,
        name: "Parent 2",
        children: [
          {id: 7, name: "Child 2.1"},
          {id: 8, name: "Child 2.2"},
          {
            id: 9,
            name: "Child 2.3",
            children: [
              {id: 10, name: "Grandchild 2.3.1"},
              {id: 11, name: "Grandchild 2.3.2"}
            ]
          }
        ]
      }
    ];

    // Goober styles
    const styles = {
      treeContainer: css`
        border: 1px solid #e0e0e0;
        border-radius: 6px;
        padding: 8px;
      `,
      treeNode: css`
        margin-left: 24px;
      `,
      treeNodeContent: css`
        display: flex;
        align-items: center;
        padding: 6px 8px;
        border-radius: 4px;
        cursor: pointer;
        user-select: none;
        &:hover {
          background: #f5f5f5;
        }
      `,
      treeNodeSelected: css`
        background: #e3f2fd !important;
        font-weight: 500;
      `,
      toggleButton: css`
        width: 24px;
        height: 24px;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        margin-right: 6px;
        border-radius: 4px;
        background: #f0f0f0;
        border: none;
        cursor: pointer;
        font-size: 12px;
        &:hover {
          background: #e0e0e0;
        }
      `,
      nodeName: css`
        flex-grow: 1;
      `,
      emptyToggle: css`
        width: 24px;
        height: 24px;
        margin-right: 6px;
      `
    };

    // TreeView Component
    const TreeView = {
      props: {
        nodes: Array,
        selectedId: [Number, String],
        depth: {
          type: Number,
          default: 0
        }
      },
      emits: ['select'],
      setup(props, {emit}) {
        const expandedNodes = ref({});

        const toggleExpand = (nodeId) => {
          expandedNodes.value = {
            ...expandedNodes.value,
            [nodeId]: !expandedNodes.value[nodeId]
          };
        };

        const isExpanded = (nodeId) => {
          return expandedNodes.value[nodeId] ?? props.depth < 1;
        };

        const hasChildren = (node) => {
          return node.children && node.children.length > 0;
        };

        const handleSelect = (node) => {
          emit('select', node);
        };

        return () => h('div', {class: styles.treeContainer},
          props.nodes.map(node => [
            h('div', {key: node.id}, [
              h('div', {
                class: [
                  styles.treeNodeContent,
                  props.selectedId === node.id ? styles.treeNodeSelected : ''
                ],
                onClick: () => handleSelect(node)
              }, [
                hasChildren(node)
                  ? h('button', {
                    class: styles.toggleButton,
                    onClick: (e) => {
                      e.stopPropagation();
                      toggleExpand(node.id);
                    }
                  }, isExpanded(node.id) ? 'âˆ’' : '+')
                  : h('div', {class: styles.emptyToggle}),
                h('span', {class: styles.nodeName}, node.name)
              ]),
              hasChildren(node) && isExpanded(node.id) &&
              h(TreeView, {
                class: styles.treeNode,
                nodes: node.children,
                selectedId: props.selectedId,
                depth: props.depth + 1,
                onSelect: (node) => emit('select', node)
              })
            ])
          ])
        );
      }
    };

    // Vue App
    const app = Vue.createApp({
      components: {TreeView},
      setup() {
        const selectedId = ref(null);
        const selectedNode = computed(() =>
          findNode(treeData, selectedId.value)
        );

        const handleSelect = (node) => {
          selectedId.value = node.id;
        };

        // Helper function to find a node by ID
        const findNode = (nodes, id) => {
          for (const node of nodes) {
            if (node.id === id) return node;
            if (node.children) {
              const found = findNode(node.children, id);
              if (found) return found;
            }
          }
          return null;
        };

        return {
          treeData,
          selectedId,
          selectedNode,
          handleSelect
        };
      }
    });

    app.mount('#app');
  </script>
</body>

</html>
